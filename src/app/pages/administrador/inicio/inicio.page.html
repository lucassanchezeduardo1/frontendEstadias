<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>Panel de Control</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="admin-container">

    <!-- Estadísticas Superiores -->
    <div class="stats-grid">
      <div class="stat-card">
        <ion-icon name="time" class="stat-icon pending"></ion-icon>
        <span class="stat-value">{{ researcherRequests.length }}</span>
        <span class="stat-label">Pendientes</span>
      </div>
      <div class="stat-card">
        <ion-icon name="people" class="stat-icon active"></ion-icon>
        <span class="stat-value">{{ stats.totalResearchers }}</span>
        <span class="stat-label">Investigadores</span>
      </div>
      <div class="stat-card">
        <ion-icon name="stats-chart" class="stat-icon activity"></ion-icon>
        <span class="stat-value">{{ stats.totalInstitutions }}</span>
        <span class="stat-label">Instituciones</span>
      </div>
    </div>

    <!-- Solicitudes Section -->
    <h2 class="section-title">Solicitudes de Ingreso</h2>

    <div *ngIf="researcherRequests.length === 0" class="empty-state" style="text-align: center; padding: 20px;">
      <ion-icon name="checkmark-circle-outline" style="font-size: 48px; color: var(--ion-color-success);"></ion-icon>
      <p>No hay solicitudes pendientes.</p>
    </div>

    <div class="researcher-card" *ngFor="let req of researcherRequests">
      <div class="card-header" (click)="viewDetails(req)" style="cursor: pointer;">
        <div class="initials-avatar">
          <img *ngIf="req.foto_perfil" [src]="getProfileImage(req.foto_perfil)"
            style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
          <span *ngIf="!req.foto_perfil">{{ req.nombre.substring(0,1) }}{{ req.apellidos.substring(0,1) }}</span>
        </div>
        <div class="researcher-info">
          <h3>{{ req.nombre }} {{ req.apellidos }}</h3>
          <div class="location">
            <ion-icon name="mail-outline"></ion-icon>
            {{ req.email }}
          </div>
          <span class="area-tag">{{ req.grado_academico }}</span>
        </div>
        <ion-icon name="eye-outline" class="detail-icon"
          style="margin-left: auto; font-size: 20px; color: var(--ion-color-medium);"></ion-icon>
      </div>
      <div class="card-actions">
        <ion-button fill="solid" class="btn-accept" (click)="approveRequest(req.id)">
          <ion-icon name="checkmark-circle" slot="start"></ion-icon>
          Aceptar
        </ion-button>
        <ion-button fill="clear" class="btn-reject" (click)="rejectRequest(req.id)">
          Rechazar
        </ion-button>
      </div>
    </div>

    <!-- Acceso rápido a otras áreas -->
    <h2 class="section-title">Resumen de Contenido</h2>
    <div class="active-item">
      <div class="mini-avatar" style="background: var(--ion-color-secondary);">
        <ion-icon name="business" style="color: white;"></ion-icon>
      </div>
      <div class="info">
        <h4>{{ stats.totalInstitutions }} Instituciones</h4>
        <p>Registradas en el sistema</p>
      </div>
      <ion-icon name="chevron-forward-outline"></ion-icon>
    </div>

    <div class="active-item">
      <div class="mini-avatar" style="background: var(--ion-color-tertiary);">
        <ion-icon name="list" style="color: white;"></ion-icon>
      </div>
      <div class="info">
        <h4>{{ stats.totalCategories }} Categorías</h4>
        <p>Áreas científicas configuradas</p>
      </div>
      <ion-icon name="chevron-forward-outline"></ion-icon>
    </div>

  </div>

  <!-- MODAL DE DETALLES -->
  <ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Detalles del Investigador</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding" *ngIf="selectedResearcher">

        <div class="profile-header">
          <div class="profile-avatar-large">
            <img [src]="getProfileImage(selectedResearcher.foto_perfil)" alt="Foto Perfil">
          </div>
          <h2>{{ selectedResearcher.nombre }} {{ selectedResearcher.apellidos }}</h2>
          <p class="subtitle">{{ selectedResearcher.grado_academico }}</p>
          <ion-badge color="warning">Pendiente de Aprobación</ion-badge>
        </div>

        <ion-list lines="none" class="details-list">
          <ion-item-group>
            <ion-item-divider>
              <ion-label>Información Académica</ion-label>
            </ion-item-divider>
            <ion-item>
              <ion-icon name="business-outline" slot="start"></ion-icon>
              <ion-label>
                <h3>Institución</h3>
                <p>{{ getInstitutionName(selectedResearcher.institucion_id) }}</p>
              </ion-label>
            </ion-item>
            <ion-item>
              <ion-icon name="id-card-outline" slot="start"></ion-icon>
              <ion-label>
                <h3>Cargo Actual</h3>
                <p>{{ selectedResearcher.cargo_actual }}</p>
              </ion-label>
            </ion-item>
            <ion-item>
              <ion-icon name="ribbon-outline" slot="start"></ion-icon>
              <ion-label>
                <h3>Matrícula</h3>
                <p>{{ selectedResearcher.matricula }}</p>
              </ion-label>
            </ion-item>
          </ion-item-group>

          <ion-item-group>
            <ion-item-divider>
              <ion-label>Contacto y Ubicación</ion-label>
            </ion-item-divider>
            <ion-item>
              <ion-icon name="location-outline" slot="start"></ion-icon>
              <ion-label>
                <h3>Dirección Oficina</h3>
                <p>{{ selectedResearcher.direccion_oficina }}</p>
              </ion-label>
            </ion-item>
            <ion-item>
              <ion-icon name="time-outline" slot="start"></ion-icon>
              <ion-label>
                <h3>Horario Atención</h3>
                <p>{{ selectedResearcher.horario_atencion }}</p>
              </ion-label>
            </ion-item>
            <ion-item>
              <ion-icon name="mail-outline" slot="start"></ion-icon>
              <ion-label>
                <h3>Email</h3>
                <p>{{ selectedResearcher.email }}</p>
              </ion-label>
            </ion-item>
          </ion-item-group>

          <ion-item-group>
            <ion-item-divider>
              <ion-label>Trayectoria y Enlaces</ion-label>
            </ion-item-divider>
            <ion-item>
              <ion-label class="ion-text-wrap">
                <h3>Descripción</h3>
                <p>{{ selectedResearcher.descripcion_trayectoria }}</p>
              </ion-label>
            </ion-item>
            <ion-item *ngIf="selectedResearcher.google_academico_url">
              <ion-icon name="logo-google" slot="start"></ion-icon>
              <ion-label>
                <h3>Google Académico</h3>
                <a [href]="selectedResearcher.google_academico_url" target="_blank">Ver perfil</a>
              </ion-label>
            </ion-item>
            <ion-item *ngIf="selectedResearcher.researchgate_url">
              <ion-icon name="globe-outline" slot="start"></ion-icon>
              <ion-label>
                <h3>ResearchGate</h3>
                <a [href]="selectedResearcher.researchgate_url" target="_blank">Ver perfil</a>
              </ion-label>
            </ion-item>
          </ion-item-group>
        </ion-list>

        <div class="modal-actions ion-margin-top">
          <ion-button expand="block" color="success" (click)="approveRequest(selectedResearcher.id)">
            <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
            Aprobar Investigador
          </ion-button>
          <ion-button expand="block" color="danger" fill="outline" (click)="rejectRequest(selectedResearcher.id)">
            <ion-icon name="close-circle-outline" slot="start"></ion-icon>
            Rechazar
          </ion-button>
        </div>

      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>