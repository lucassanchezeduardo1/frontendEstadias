<ion-content class="login-content">
    <div class="login-container">
        <div class="background-gradient"></div>

        <div class="login-card register-card">
            <div class="app-icon">
                <ion-icon name="person-add-outline"></ion-icon>
            </div>

            <h1 class="login-title">Crear Cuenta</h1>
            <p class="login-subtitle">Únete a la red de divulgación científica</p>

            <!-- Selector de tipo de usuario -->
            <div class="user-type-selector">
                <button class="user-type-btn" [class.active]="selectedUserType === 'student'"
                    (click)="selectUserType('student')">
                    Estudiante
                </button>
                <button class="user-type-btn" [class.active]="selectedUserType === 'researcher'"
                    (click)="selectUserType('researcher')">
                    Investigador
                </button>
            </div>

            <!-- Formulario Estudiante -->
            <form class="login-form" *ngIf="selectedUserType === 'student'" (ngSubmit)="onRegister()">
                <div class="input-grid">
                    <div class="input-group">
                        <ion-icon name="person-outline" class="input-icon"></ion-icon>
                        <input type="text" class="custom-input" placeholder="Nombre(s)" 
                            [(ngModel)]="newEstudiante.nombre" name="nombre" required>
                    </div>
                    <div class="input-group">
                        <ion-icon name="person-outline" class="input-icon"></ion-icon>
                        <input type="text" class="custom-input" placeholder="Apellidos" 
                            [(ngModel)]="newEstudiante.apellidos" name="apellidos" required>
                    </div>
                </div>

                <div class="input-group">
                    <ion-icon name="mail-outline" class="input-icon"></ion-icon>
                    <input type="email" class="custom-input" placeholder="Correo electrónico" 
                        [(ngModel)]="newEstudiante.email" name="email" required>
                </div>

                <div class="input-group">
                    <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                    <input [type]="showPassword ? 'text' : 'password'" class="custom-input" placeholder="Contraseña"
                        [(ngModel)]="newEstudiante.password" name="password" required>
                </div>

                <div class="input-grid">
                    <div class="input-group">
                        <ion-icon name="briefcase-outline" class="input-icon"></ion-icon>
                        <input type="text" class="custom-input" placeholder="Oficio" 
                            [(ngModel)]="newEstudiante.oficio" name="oficio" required>
                    </div>
                    <div class="input-group">
                        <ion-icon name="school-outline" class="input-icon"></ion-icon>
                        <input type="text" class="custom-input" placeholder="Grado Académico" 
                            [(ngModel)]="newEstudiante.grado_academico" name="grado_academico" required>
                    </div>
                </div>

                <div class="input-group">
                    <ion-icon name="calendar-outline" class="input-icon"></ion-icon>
                    <input type="number" class="custom-input" placeholder="Edad" 
                        [(ngModel)]="newEstudiante.edad" name="edad" required>
                </div>

                <div class="input-group file-input">
                    <ion-icon name="image-outline" class="input-icon"></ion-icon>
                    <label class="custom-file-label">{{ selectedFile ? selectedFile.name : 'Foto de Perfil' }}</label>
                    <input type="file" class="hidden-file-input" (change)="onFileSelected($event)" accept="image/*">
                </div>

                <button type="submit" class="login-btn">
                    Registrar Estudiante
                    <ion-icon name="checkmark-circle-outline"></ion-icon>
                </button>
            </form>

            <!-- Formulario Investigador -->
            <form class="login-form researcher-form" *ngIf="selectedUserType === 'researcher'"
                (ngSubmit)="onRegister()">
                <div class="input-grid">
                    <div class="input-group">
                        <ion-icon name="person-outline" class="input-icon"></ion-icon>
                        <input type="text" class="custom-input" placeholder="Nombre(s)"
                            [(ngModel)]="newInvestigador.nombre" name="nombre" required>
                    </div>
                    <div class="input-group">
                        <ion-icon name="person-outline" class="input-icon"></ion-icon>
                        <input type="text" class="custom-input" placeholder="Apellidos"
                            [(ngModel)]="newInvestigador.apellidos" name="apellidos" required>
                    </div>
                </div>

                <div class="input-grid">
                    <div class="input-group">
                        <ion-icon name="school-outline" class="input-icon"></ion-icon>
                        <input type="text" class="custom-input" placeholder="Grado Académico"
                            [(ngModel)]="newInvestigador.grado_academico" name="grado_academico" required>
                    </div>
                    <div class="input-group">
                        <ion-icon name="id-card-outline" class="input-icon"></ion-icon>
                        <input type="text" class="custom-input" placeholder="Cargo Actual"
                            [(ngModel)]="newInvestigador.cargo_actual" name="cargo_actual" required>
                    </div>
                </div>

                <div class="input-group">
                    <ion-icon name="location-outline" class="input-icon"></ion-icon>
                    <input type="text" class="custom-input" placeholder="Dirección de Oficina"
                        [(ngModel)]="newInvestigador.direccion_oficina" name="direccion_oficina" required>
                </div>

                <div class="input-group">
                    <ion-icon name="time-outline" class="input-icon"></ion-icon>
                    <input type="text" class="custom-input" placeholder="Horario de Atención"
                        [(ngModel)]="newInvestigador.horario_atencion" name="horario_atencion" required>
                </div>

                <div class="input-group">
                    <ion-icon name="mail-outline" class="input-icon"></ion-icon>
                    <input type="email" class="custom-input" placeholder="Correo Institucional"
                        [(ngModel)]="newInvestigador.email" name="email" required>
                </div>

                <div class="input-group">
                    <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                    <input [type]="showPassword ? 'text' : 'password'" class="custom-input" placeholder="Contraseña"
                        [(ngModel)]="newInvestigador.password" name="password" required>
                </div>

                <div class="input-grid">
                    <div class="input-group">
                        <ion-icon name="ribbon-outline" class="input-icon"></ion-icon>
                        <input type="text" class="custom-input" placeholder="Matrícula"
                            [(ngModel)]="newInvestigador.matricula" name="matricula" required>
                    </div>
                    <div class="input-group">
                        <ion-icon name="business-outline" class="input-icon"></ion-icon>
                        <select class="custom-select" [(ngModel)]="newInvestigador.institucion_id" name="institucion_id"
                            required>
                            <option [ngValue]="null" disabled selected>Institución</option>
                            <option *ngFor="let inst of institutions" [value]="inst.id">{{inst.nombre}}</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <ion-icon name="logo-google" class="input-icon"></ion-icon>
                    <input type="url" class="custom-input" placeholder="Link Google Académico (Opcional)"
                        [(ngModel)]="newInvestigador.google_academico_url" name="google_academico_url">
                </div>

                <div class="input-group">
                    <ion-icon name="globe-outline" class="input-icon"></ion-icon>
                    <input type="url" class="custom-input" placeholder="Link ResearchGate (Opcional)"
                        [(ngModel)]="newInvestigador.researchgate_url" name="researchgate_url">
                </div>

                <div class="input-group">
                    <ion-icon name="document-text-outline" class="input-icon"></ion-icon>
                    <textarea class="custom-textarea" placeholder="Breve descripción de trayectoria..." rows="3"
                        [(ngModel)]="newInvestigador.descripcion_trayectoria" name="descripcion_trayectoria"
                        required></textarea>
                </div>

                <div class="input-group">
                    <ion-icon name="flask-outline" class="input-icon"></ion-icon>
                    <input type="text" class="custom-input" placeholder="Área(s) de Investigación"
                        [(ngModel)]="newInvestigador.areas_investigacion" name="areas_investigacion" required>
                </div>

                <div class="input-group file-input">
                    <ion-icon name="image-outline" class="input-icon"></ion-icon>
                    <label class="custom-file-label">{{ selectedFile ? selectedFile.name : 'Foto de Perfil' }}</label>
                    <input type="file" class="hidden-file-input" (change)="onFileSelected($event)" accept="image/*"
                        required>
                </div>

                <button type="submit" class="login-btn">
                    Solicitar Registro
                    <ion-icon name="send-outline"></ion-icon>
                </button>
            </form>

            <div class="register-section">
                <p class="register-text">
                    ¿Ya tienes cuenta?
                    <a (click)="goToLogin()" class="register-link">Inicia sesión</a>
                </p>
            </div>
        </div>
    </div>
</ion-content>