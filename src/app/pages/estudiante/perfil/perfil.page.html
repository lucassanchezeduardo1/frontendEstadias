<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>Mi Perfil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="usuario">
  <div class="main-container">

    <div class="profile-header">
      <div class="avatar-wrapper">
        <img [src]="photoPreview" alt="Profile Picture" onerror="this.src='assets/icon/favicon.png'">
        <div class="edit-badge" *ngIf="isEditing" (click)="fileInput.click()">
          <ion-icon name="camera-outline"></ion-icon>
          <input type="file" #fileInput class="hidden-input" (change)="onFileSelected($event)" accept="image/*"
            style="display: none;">
        </div>
      </div>
      <h2>{{ usuario.nombre }} {{ usuario.apellidos }}</h2>
      <p>{{ usuario.email }}</p>
    </div>

    <div class="info-sections">
      <div class="info-card">
        <div class="card-title">Información Personal</div>

        <div class="field">
          <label>Nombre(s)</label>
          <p *ngIf="!isEditing">{{ usuario.nombre }}</p>
          <ion-input *ngIf="isEditing" [(ngModel)]="usuario.nombre" class="custom-input"></ion-input>
        </div>

        <div class="field">
          <label>Apellidos</label>
          <p *ngIf="!isEditing">{{ usuario.apellidos }}</p>
          <ion-input *ngIf="isEditing" [(ngModel)]="usuario.apellidos" class="custom-input"></ion-input>
        </div>

        <div class="field">
          <label>Edad</label>
          <p *ngIf="!isEditing">{{ usuario.edad }} años</p>
          <ion-input *ngIf="isEditing" type="number" [(ngModel)]="usuario.edad" class="custom-input"></ion-input>
        </div>
      </div>

      <div class="info-card">
        <div class="card-title">Académico y Profesional</div>

        <div class="field">
          <label>Oficio / Ocupación</label>
          <p *ngIf="!isEditing">{{ usuario.oficio }}</p>
          <ion-input *ngIf="isEditing" [(ngModel)]="usuario.oficio" class="custom-input"></ion-input>
        </div>

        <div class="field">
          <label>Grado Académico</label>
          <p *ngIf="!isEditing">{{ usuario.grado_academico }}</p>
          <ion-input *ngIf="isEditing" [(ngModel)]="usuario.grado_academico" class="custom-input"></ion-input>
        </div>
      </div>

      <div class="info-card">
        <div class="card-title">Contacto</div>

        <div class="field">
          <label>Correo Electrónico</label>
          <p *ngIf="!isEditing">{{ usuario.email }}</p>
          <ion-input *ngIf="isEditing" type="email" [(ngModel)]="usuario.email" class="custom-input"></ion-input>
        </div>
      </div>
    </div>

    <div class="actions-section">
      <!-- Botón Editar Datos (Solo visible cuando no se está editando) -->
      <ion-button *ngIf="!isEditing" expand="block" fill="outline" color="primary" class="edit-btn"
        (click)="toggleEdit()">
        <ion-icon name="create-outline" slot="start"></ion-icon>
        Editar Datos
      </ion-button>

      <!-- Botón Guardar Cambios (Solo visible cuando se está editando) -->
      <ion-button *ngIf="isEditing" expand="block" color="success" class="save-btn" (click)="confirmSave()">
        <ion-icon name="save-outline" slot="start"></ion-icon>
        Guardar Cambios
      </ion-button>

      <!-- Botón Cancelar Edición (Solo visible cuando se está editando) -->
      <ion-button *ngIf="isEditing" expand="block" fill="outline" color="medium" class="cancel-btn"
        (click)="toggleEdit()">
        <ion-icon name="close-circle-outline" slot="start"></ion-icon>
        Cancelar Edición
      </ion-button>

      <!-- Botón Cerrar Sesión -->
      <ion-button expand="block" fill="outline" color="danger" class="logout-btn" (click)="cerrarSesion()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Cerrar Sesión
      </ion-button>
    </div>

  </div>
</ion-content>